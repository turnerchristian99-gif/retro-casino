<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Royale Ultra</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect x='20' y='20' width='60' height='70' rx='5' fill='%23222' stroke='%230ff' stroke-width='4'/%3E%3Crect x='30' y='35' width='40' height='20' fill='%23000' stroke='%23f0f' stroke-width='2'/%3E%3Ccircle cx='85' cy='40' r='6' fill='%23f0f'/%3E%3Cpath d='M85 40 L85 70' stroke='%23f0f' stroke-width='4'/%3E%3Ctext x='50' y='50' font-family='Arial' font-size='12' fill='%230ff' text-anchor='middle'%3E777%3C/text%3E%3C/svg%3E">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-pink: #ff00ff;
            --neon-blue: #00ffff;
            --neon-purple: #9d00ff;
            --dark-bg: #050110;
            --felt-green: #0a4d2e;
        }

        body {
            background-color: var(--dark-bg);
            background-image: 
                linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 255, 0, 0.06));
            background-size: 100% 4px, 3px 100%;
            color: #e0e0e0;
            font-family: 'Space Mono', monospace;
            overflow-x: hidden;
            margin: 0;
        }

        h1, h2, h3, .orbitron { font-family: 'Orbitron', sans-serif; }

        .crt-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), radial-gradient(rgba(18, 16, 16, 0) 0%, rgba(0, 0, 0, 0.2) 100%);
            pointer-events: none;
            z-index: 100;
        }

        .neon-box {
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3), inset 0 0 10px rgba(0, 255, 255, 0.2);
            background: rgba(13, 2, 33, 0.9);
            backdrop-filter: blur(8px);
        }

        .btn-retro {
            background: rgba(255, 0, 255, 0.1);
            border: 1px solid var(--neon-pink);
            color: var(--neon-pink);
            transition: all 0.2s;
            text-transform: uppercase;
            font-weight: bold;
            padding: 8px 16px;
            cursor: pointer;
        }

        .btn-retro:hover:not(:disabled) {
            background: var(--neon-pink);
            color: white;
            box-shadow: 0 0 20px var(--neon-pink);
        }

        .btn-retro:disabled { opacity: 0.3; cursor: not-allowed; }

        .card {
            width: 60px;
            height: 85px;
            background: #fff;
            border-radius: 6px;
            color: #111;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 5px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
            font-size: 12px;
            position: relative;
        }
        .card.red { color: #d00; }
        .card.hidden-card {
            background: repeating-linear-gradient(45deg, #222, #222 5px, #444 5px, #444 10px);
            border: 2px solid #555;
        }

        .table-felt {
            background: radial-gradient(circle, var(--felt-green) 0%, #052617 100%);
            border: 12px solid #2d1b0f;
            border-radius: 20px;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
        }

        .page {
            display: none;
            animation: fadeIn 0.5s;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .roulette-grid {
            display: grid;
            grid-template-columns: repeat(14, 1fr);
            gap: 2px;
            background: #111;
            padding: 2px;
            border: 2px solid #444;
        }
        .r-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 10px;
            font-weight: bold;
            transition: background 0.2s;
        }
        .r-cell:hover { filter: brightness(1.5); }
        .r-red { background: #d00; }
        .r-black { background: #111; }
        .r-green { background: #0a0; }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: none; align-items: center;
            justify-content: center; z-index: 200; padding: 20px;
        }

        .roulette-wheel-container {
            width: 320px;
            height: 320px;
            border: 12px solid #2d1b0f;
            border-radius: 50%;
            position: relative;
            background: #111;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1);
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, #ddd, #666);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 20;
            box-shadow: 0 0 15px rgba(0,0,0,0.8);
        }

        .wheel-number-item {
            position: absolute;
            top: 10px;
            left: 50%;
            width: 24px;
            margin-left: -12px;
            height: 140px;
            transform-origin: bottom center;
            text-align: center;
            font-weight: bold;
            font-size: 11px;
            z-index: 15;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .poker-player-area {
            transition: all 0.3s ease;
            padding: 10px;
            border-radius: 10px;
            width: 120px;
        }
        .poker-player-area.active-turn {
            background: rgba(0, 255, 255, 0.15);
            box-shadow: 0 0 20px var(--neon-blue);
            transform: scale(1.1);
        }

        .info-pulse {
            animation: pulse-border 2s infinite;
        }
        @keyframes pulse-border {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 255, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(0, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 255, 0); }
        }

        .rule-list { text-align: left; margin-bottom: 20px; }
        .rule-list li { margin-bottom: 8px; font-size: 13px; line-height: 1.4; }
        .rule-list b { color: var(--neon-blue); }
        
        #info-modal .neon-box { max-height: 90vh; overflow-y: auto; }

        /* Slot Machine Wheel */
        .slot-wheel {
            width: 100px;
            height: 300px;
            overflow: hidden;
            position: relative;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent 20%, transparent 80%, rgba(0,0,0,0.8));
            border: 4px solid #9d00ff;
            border-radius: 10px;
        }

        .slot-reel {
            position: absolute;
            width: 100%;
            transition: top 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .slot-symbol {
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            background: rgba(0,0,0,0.3);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>
    <div class="crt-overlay"></div>

    <!-- LOGIN PAGE -->
    <div id="page-login" class="page active">
        <div class="fixed inset-0 flex items-center justify-center">
            <div class="neon-box p-8 w-80 text-center">
                <h2 class="orbitron text-xl text-cyan-400 mb-4">RETRO ROYAL CASINO</h2>
                <input id="player-name" placeholder="Your Name" class="w-full mb-3 p-2 bg-black border border-cyan-400 text-cyan-300">
                <button id="login-btn" onclick="loginPlayer()" class="btn-retro w-full" disabled>ENTER CASINO</button>
            </div>
        </div>
    </div>

    <!-- MAIN MENU PAGE -->
    <div id="page-menu" class="page">
        <div class="max-w-6xl mx-auto p-6">
            <header class="mb-8 flex items-center justify-between flex-wrap gap-4">
                <div>
                    <h1 class="text-5xl orbitron bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500 bg-clip-text text-transparent mb-2">
                        RETRO ROYALE ULTRA
                    </h1>
                    <p class="text-xs opacity-60 tracking-widest">EST. 2025 // GAMING PARADISE</p>
                </div>
                <button onclick="resetAll()" class="btn-retro text-xs px-3 py-1">RESET SAVE</button>
            </header>

            <!-- HUD Bar -->
            <div class="neon-box p-4 mb-6 flex justify-between items-center flex-wrap gap-4">
                <div>
                    <p class="text-xs opacity-60 mb-1">BALANCE</p>
                    <p class="text-3xl orbitron" style="color: var(--neon-blue);" id="hud-balance">$1000</p>
                </div>
                <div class="flex gap-6">
                    <div>
                        <p class="text-xs opacity-60 mb-1">BIGGEST WIN</p>
                        <p class="text-xl orbitron text-yellow-400" id="hud-bigwin">$0</p>
                    </div>
                    <div>
                        <p class="text-xs opacity-60 mb-1">TOTAL WAGERED</p>
                        <p class="text-xl orbitron text-green-400" id="hud-wagered">$0</p>
                    </div>
                    <div>
                        <p class="text-xs opacity-60 mb-1">GAMES PLAYED</p>
                        <p class="text-xl orbitron text-cyan-300" id="hud-games">0</p>
                    </div>
                </div>
                <div id="debt-warning" class="bg-red-900 bg-opacity-40 px-4 py-2 rounded border border-red-600" style="display: none;">
                    <p class="text-xs text-red-300 mb-1">IN DEBT</p>
                    <p class="text-sm text-white orbitron">REACH $2,500 TO BREAK THE BANK</p>
                </div>
            </div>

            <!-- Game Menu -->
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
                <button onclick="navigateToGame('blackjack')" class="btn-retro py-6 text-sm flex flex-col items-center gap-2">
                    <span class="text-2xl">üÇ°</span>
                    <span>BLACKJACK</span>
                </button>
                <button onclick="navigateToGame('roulette')" class="btn-retro py-6 text-sm flex flex-col items-center gap-2">
                    <span class="text-2xl">üé∞</span>
                    <span>ROULETTE</span>
                </button>
                <button onclick="navigateToGame('poker')" class="btn-retro py-6 text-sm flex flex-col items-center gap-2">
                    <span class="text-2xl">üÉè</span>
                    <span>POKER</span>
                </button>
                <button onclick="navigateToGame('craps')" class="btn-retro py-6 text-sm flex flex-col items-center gap-2">
                    <span class="text-2xl">üé≤</span>
                    <span>CRAPS</span>
                </button>
                <button onclick="navigateToGame('slots')" class="btn-retro py-6 text-sm flex flex-col items-center gap-2">
                    <span class="text-2xl">üíé</span>
                    <span>SLOTS</span>
                </button>
            </div>
        </div>
    </div>

    <!-- BLACKJACK PAGE -->
    <div id="page-blackjack" class="page">
        <div class="max-w-4xl mx-auto p-6">
            <div class="neon-box p-6 table-felt">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl orbitron text-white">BLACKJACK</h2>
                    <div class="flex gap-2">
                        <button onclick="showInfoModal('blackjack')" class="btn-retro px-4 info-pulse">RULES</button>
                        <button onclick="navigateToGame('menu')" class="btn-retro px-4">BACK TO MENU</button>
                    </div>
                </div>

                <div id="bj-multiplayer-setup" class="flex gap-4 justify-center mb-6">
                    <button onclick="hostGame('blackjack')" class="btn-retro">HOST GAME</button>
                    <button onclick="joinGame('blackjack')" class="btn-retro">JOIN GAME</button>
                    <button onclick="startSoloBlackjack()" class="btn-retro">PLAY SOLO</button>
                </div>

                <div id="bj-game-area" style="display:none;">
                    <div class="mb-8 text-center">
                        <p class="text-sm opacity-70 mb-2">DEALER</p>
                        <div class="flex justify-center gap-2 mb-2" id="dealer-hand"></div>
                        <p class="text-sm" id="dealer-score">SCORE: 0</p>
                    </div>

                    <div class="mb-8 text-center">
                        <p class="text-sm opacity-70 mb-2">PLAYER</p>
                        <div class="flex justify-center gap-2 mb-2" id="player-hand"></div>
                        <p class="text-sm" id="player-score">SCORE: 0</p>
                    </div>

                    <div class="flex gap-3 flex-wrap justify-center mb-4">
                        <button onclick="bjAction('hit')" id="btn-hit" class="btn-retro" disabled>HIT</button>
                        <button onclick="bjAction('stand')" id="btn-stand" class="btn-retro" disabled>STAND</button>
                        <button onclick="bjAction('double')" id="btn-double" class="btn-retro" disabled>DOUBLE DOWN</button>
                    </div>

                    <div class="flex items-center justify-center gap-4 flex-wrap">
                        <label class="text-sm">BET:</label>
                        <input type="number" id="bj-bet-input" value="50" min="10" step="10" class="w-24 px-2 py-1 bg-black text-cyan-300 border border-cyan-500">
                        <button onclick="dealBlackjack()" class="btn-retro">DEAL</button>
                    </div>

                    <p class="text-center mt-4 text-sm" id="bj-result"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- ROULETTE PAGE -->
    <div id="page-roulette" class="page">
        <div class="max-w-5xl mx-auto p-6">
            <div class="neon-box p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl orbitron text-white">ROULETTE</h2>
                    <div class="flex gap-2">
                        <button onclick="showInfoModal('roulette')" class="btn-retro px-4 info-pulse">RULES</button>
                        <button onclick="navigateToGame('menu')" class="btn-retro px-4">BACK TO MENU</button>
                    </div>
                </div>

                <div id="roulette-multiplayer-setup" class="flex gap-4 justify-center mb-6">
                    <button onclick="hostGame('roulette')" class="btn-retro">HOST GAME</button>
                    <button onclick="joinGame('roulette')" class="btn-retro">JOIN GAME</button>
                    <button onclick="startSoloRoulette()" class="btn-retro">PLAY SOLO</button>
                </div>

                <div id="roulette-game-area" style="display:none;">
                    <div class="mb-4 flex items-center gap-4 flex-wrap">
                        <label class="text-sm">BET AMOUNT:</label>
                        <input type="number" id="roulette-bet-amount" value="50" min="10" step="10" class="w-24 px-2 py-1 bg-black text-cyan-300 border border-cyan-500">
                        <button onclick="clearRouletteBets()" class="btn-retro text-xs px-3">CLEAR BETS</button>
                        <span class="text-sm ml-auto">TOTAL BET: <span class="text-yellow-400 font-bold" id="roulette-total-bet">$0</span></span>
                    </div>

                    <div class="roulette-grid mb-6"></div>

                    <div class="text-center">
                        <button onclick="spinRoulette()" id="btn-spin-roulette" class="btn-retro px-12 py-3 text-xl" disabled>SPIN</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- POKER PAGE -->
    <div id="page-poker" class="page">
        <div class="max-w-6xl mx-auto p-6">
            <div class="neon-box p-6 table-felt">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl orbitron text-white">TEXAS HOLD'EM</h2>
                    <div class="flex gap-2">
                        <button onclick="showInfoModal('poker')" class="btn-retro px-4 info-pulse">RULES</button>
                        <button onclick="navigateToGame('menu')" class="btn-retro px-4">BACK TO MENU</button>
                    </div>
                </div>

                <div id="poker-setup" class="flex gap-4 justify-center mb-6">
                    <button onclick="hostGame('poker')" class="btn-retro">HOST POKER TABLE</button>
                    <button onclick="joinGame('poker')" class="btn-retro">JOIN TABLE</button>
                    <button onclick="startSoloPoker()" class="btn-retro">SOLO GAME (AI)</button>
                </div>

                <div class="relative flex flex-col items-center" style="min-height: 500px;">
                    <div id="p-slot-1" class="poker-player-slot absolute top-0 poker-player-area" style="display:none;">
                        <p class="text-[10px] opacity-60 mb-1" id="p-name-1">Player 1</p>
                        <div class="flex gap-1 mb-1 justify-center" data-player="1"></div>
                        <p class="text-xs">$<span data-balance="1">1000</span></p>
                        <p class="text-[10px] opacity-50">BET: $<span data-bet="1">0</span></p>
                    </div>

                    <div id="p-slot-2" class="poker-player-slot absolute left-0 top-1/2 -translate-y-1/2 poker-player-area" style="display:none;">
                        <p class="text-[10px] opacity-60 mb-1" id="p-name-2">Player 2</p>
                        <div class="flex gap-1 mb-1 justify-center" data-player="2"></div>
                        <p class="text-xs">$<span data-balance="2">1000</span></p>
                        <p class="text-[10px] opacity-50">BET: $<span data-bet="2">0</span></p>
                    </div>

                    <div id="p-slot-3" class="poker-player-slot absolute right-0 top-1/2 -translate-y-1/2 poker-player-area" style="display:none;">
                        <p class="text-[10px] opacity-60 mb-1" id="p-name-3">Player 3</p>
                        <div class="flex gap-1 mb-1 justify-center" data-player="3"></div>
                        <p class="text-xs">$<span data-balance="3">1000</span></p>
                        <p class="text-[10px] opacity-50">BET: $<span data-bet="3">0</span></p>
                    </div>

                    <div id="poker-community" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center" style="z-index:10;">
                        <p class="text-xs opacity-60 mb-2">COMMUNITY CARDS</p>
                        <div id="community-cards" class="flex gap-2 justify-center mb-2"></div>
                        <p class="text-sm text-yellow-400 font-bold">POT: $<span id="poker-pot">0</span></p>
                    </div>

                    <div id="p-slot-0" class="poker-player-slot absolute bottom-0 poker-player-area">
                        <p class="text-[10px] opacity-60 mb-1" id="p-name-0">YOU</p>
                        <div class="flex gap-1 mb-1 justify-center" data-player="0"></div>
                        <p class="text-xs">$<span data-balance="0">1000</span></p>
                        <p class="text-[10px] opacity-50">BET: $<span data-bet="0">0</span></p>
                    </div>
                </div>

                <div class="flex gap-3 justify-center mt-6 flex-wrap" id="poker-actions">
                    <button onclick="pokerAction('fold')" class="btn-retro" id="btn-fold" disabled>FOLD</button>
                    <button onclick="pokerAction('call')" class="btn-retro" id="btn-call" disabled>CALL</button>
                    <button onclick="pokerAction('raise')" class="btn-retro" id="btn-raise" disabled>RAISE $50</button>
                </div>

                <p class="text-center mt-4 text-sm" id="poker-result"></p>
            </div>
        </div>
    </div>

    <!-- CRAPS PAGE -->
    <div id="page-craps" class="page">
        <div class="max-w-4xl mx-auto p-6">
            <div class="neon-box p-6 table-felt">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl orbitron text-white">CRAPS</h2>
                    <div class="flex gap-2">
                        <button onclick="showInfoModal('craps')" class="btn-retro px-4 info-pulse">RULES</button>
                        <button onclick="navigateToGame('menu')" class="btn-retro px-4">BACK TO MENU</button>
                    </div>
                </div>

                <div id="craps-multiplayer-setup" class="flex gap-4 justify-center mb-6">
                    <button onclick="hostGame('craps')" class="btn-retro">HOST GAME</button>
                    <button onclick="joinGame('craps')" class="btn-retro">JOIN GAME</button>
                    <button onclick="startSoloCraps()" class="btn-retro">PLAY SOLO</button>
                </div>

                <div id="craps-game-area" style="display:none;">
                    <div class="flex justify-center gap-6 mb-6" id="craps-dice">
                        <div class="w-16 h-16 bg-white text-black flex items-center justify-center text-3xl font-bold rounded-lg shadow-xl">1</div>
                        <div class="w-16 h-16 bg-white text-black flex items-center justify-center text-3xl font-bold rounded-lg shadow-xl">1</div>
                    </div>

                    <p class="text-center text-xl orbitron text-yellow-400 mb-4" id="craps-point-display">POINT: OFF</p>

                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="neon-box p-3 text-center">
                            <p class="text-xs opacity-60 mb-1">PASS LINE</p>
                            <p class="text-sm mb-2">BET: <span class="text-yellow-400" id="bet-pass">$0</span></p>
                            <input type="number" id="craps-bet-pass" value="50" min="10" step="10" class="w-20 px-2 py-1 bg-black text-cyan-300 border border-cyan-500 mb-2">
                            <button onclick="placeCrapsBet('pass')" class="btn-retro text-xs w-full">PLACE BET</button>
                        </div>
                        <div class="neon-box p-3 text-center">
                            <p class="text-xs opacity-60 mb-1">FIELD</p>
                            <p class="text-sm mb-2">BET: <span class="text-yellow-400" id="bet-field">$0</span></p>
                            <input type="number" id="craps-bet-field" value="50" min="10" step="10" class="w-20 px-2 py-1 bg-black text-cyan-300 border border-cyan-500 mb-2">
                            <button onclick="placeCrapsBet('field')" class="btn-retro text-xs w-full">PLACE BET</button>
                        </div>
                    </div>

                    <div class="text-center">
                        <button onclick="rollDice()" class="btn-retro px-12 py-3 text-xl">ROLL DICE</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SLOTS PAGE -->
    <div id="page-slots" class="page">
        <div class="max-w-4xl mx-auto p-6">
            <div class="neon-box p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl orbitron text-white">NEON SLOTS</h2>
                    <div class="flex gap-2">
                        <button onclick="showInfoModal('slots')" class="btn-retro px-4 info-pulse">RULES</button>
                        <button onclick="navigateToGame('menu')" class="btn-retro px-4">BACK TO MENU</button>
                    </div>
                </div>

                <div id="slots-multiplayer-setup" class="flex gap-4 justify-center mb-6">
                    <button onclick="hostGame('slots')" class="btn-retro">HOST GAME</button>
                    <button onclick="joinGame('slots')" class="btn-retro">JOIN GAME</button>
                    <button onclick="startSoloSlots()" class="btn-retro">PLAY SOLO</button>
                </div>

                <div id="slots-game-area" style="display:none;">
                    <!-- Slot Machine Wheels -->
                    <div class="flex justify-center gap-4 mb-6">
                        <div class="slot-wheel" id="wheel-1">
                            <div class="slot-reel" id="reel-1"></div>
                        </div>
                        <div class="slot-wheel" id="wheel-2">
                            <div class="slot-reel" id="reel-2"></div>
                        </div>
                        <div class="slot-wheel" id="wheel-3">
                            <div class="slot-reel" id="reel-3"></div>
                        </div>
                    </div>

                    <div class="flex items-center justify-center gap-4 flex-wrap mb-4">
                        <label class="text-sm">BET:</label>
                        <input type="number" id="slots-bet-input" value="50" min="10" step="10" class="w-24 px-2 py-1 bg-black text-cyan-300 border border-cyan-500">
                        <button onclick="spinSlots()" class="btn-retro px-12">SPIN</button>
                    </div>

                    <p class="text-center text-sm" id="slots-result"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="bailout-modal" class="modal-overlay">
        <div class="neon-box p-8 max-w-md text-center">
            <h2 class="text-3xl orbitron text-red-500 mb-4">BANKRUPT</h2>
            <p class="mb-6">You are out of credits. We can lend you <span class="text-yellow-400 font-bold">$500</span>, but you'll be in <span class="text-red-400">DEBT</span>.</p>
            <p class="text-xs opacity-60 mb-6">In Debt mode, you must reach $2,500 to "Break the Bank" and return to normal play.</p>
            <button onclick="acceptBailout()" class="btn-retro w-full">ACCEPT LOAN</button>
        </div>
    </div>

    <div id="info-modal" class="modal-overlay" onclick="closeInfoModal()">
        <div class="neon-box p-8 max-w-lg w-full" onclick="event.stopPropagation()">
            <h2 class="text-2xl orbitron text-cyan-400 mb-4 flex items-center gap-2">
                <span>HOW TO PLAY</span>
                <button onclick="closeInfoModal()" class="ml-auto text-sm btn-retro px-3">CLOSE</button>
            </h2>
            <div id="info-modal-content"></div>
        </div>
    </div>

    <div id="roulette-spin-modal" class="modal-overlay">
        <div class="flex flex-col items-center">
            <div class="roulette-wheel-container" id="roulette-wheel">
                <div class="wheel-center"></div>
            </div>
            <p class="text-2xl orbitron mt-6 text-cyan-400" id="roulette-result-text"></p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
  apiKey: "AIzaSyC9nLHaL7Lc050imleIUeuq8EKD4Fi5qHU",
  authDomain: "retro-royal-casino.firebaseapp.com",
  projectId: "retro-royal-casino",
  storageBucket: "retro-royal-casino.firebasestorage.app",
  messagingSenderId: "441287288010",
  appId: "1:441287288010:web:faa72345e09aa619138033",
  measurementId: "G-3ZEK75NN35"
};

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        window.db = db;
        window.auth = auth;
        window.firestore = { doc, setDoc, getDoc, updateDoc, onSnapshot };
        window.currentUID = null;
        window.playerData = null;

        signInAnonymously(auth).then(() => {
            console.log("Signed in anonymously");
        });

        onAuthStateChanged(auth, (user) => {
            if (user) {
                window.currentUID = user.uid;
                document.getElementById('login-btn').disabled = false;
                console.log("User authenticated:", user.uid);
            }
        });
    </script>

    <script>
        /* ======================
           NAVIGATION SYSTEM
        ====================== */
        function navigateToGame(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${pageName}`).classList.add('active');
        }

        /* ======================
           CORE STATE & STORAGE
        ====================== */
        let state = {
            balance: 1000,
            stats: { biggestWin: 0, totalWagered: 0, gamesPlayed: 0 },
            debt: false
        };

        let currentGame = null;
        let gameMode = "single"; // "single" or "multi"
        let roomId = null;
        let isHost = false;
        let roomUnsubscribe = null;

        function saveGame() {
            localStorage.setItem('retroRoyale', JSON.stringify(state));
        }

        function loadGame() {
            const saved = localStorage.getItem('retroRoyale');
            if (saved) state = JSON.parse(saved);
            updateHUD();
        }

        function updateHUD() {
            document.getElementById('hud-balance').innerText = '$' + state.balance;
            document.getElementById('hud-bigwin').innerText = '$' + state.stats.biggestWin;
            document.getElementById('hud-wagered').innerText = '$' + state.stats.totalWagered;
            document.getElementById('hud-games').innerText = state.stats.gamesPlayed;
            document.getElementById('debt-warning').style.display = state.debt ? 'block' : 'none';
        }

        function updateBalance(amount) {
            state.balance += amount;
            if (amount > 0 && amount > state.stats.biggestWin) state.stats.biggestWin = amount;
            if (state.debt && state.balance >= 2500) {
                state.debt = false;
                alert('üéâ DEBT CLEARED! YOU BROKE THE BANK!');
            }
            updateHUD();
            saveGame();
        }

        function deductBet(amount) {
            if (state.balance < amount) return false;
            state.balance -= amount;
            state.stats.totalWagered += amount;
            state.stats.gamesPlayed++;
            updateHUD();
            saveGame();
            return true;
        }

        function checkBankruptcy() {
            if (state.balance <= 0 && !state.debt) {
                document.getElementById('bailout-modal').style.display = 'flex';
            }
        }

        function acceptBailout() {
            state.balance = 500;
            state.debt = true;
            document.getElementById('bailout-modal').style.display = 'none';
            updateHUD();
            saveGame();
        }

        function resetAll() {
            if (!confirm('Reset all progress?')) return;
            localStorage.clear();
            location.reload();
        }

        async function loginPlayer() {
            if (!window.currentUID) return alert("Still connecting to server...");

            const name = document.getElementById("player-name").value.trim();
            if (!name) return alert("Enter a name");

            const { doc, setDoc } = window.firestore;
            const ref = doc(window.db, "players", window.currentUID);
            const data = { name, balance: state.balance || 1000 };
            
            await setDoc(ref, data, { merge: true });
            window.playerData = data;
            navigateToGame('menu');
        }

        /* ======================
           MULTIPLAYER CORE
        ====================== */
        async function hostGame(game) {
            if (!window.currentUID || !window.playerData) {
                return alert("Please log in first!");
            }
            
            gameMode = "multi";
            isHost = true;
            currentGame = game;
            roomId = crypto.randomUUID().slice(0,6);

            const { doc, setDoc } = window.firestore;
            await setDoc(doc(window.db, "rooms", roomId), {
                game,
                host: window.currentUID,
                players: { [window.currentUID]: window.playerData },
                gameState: null
            });

            document.getElementById(`${game}-multiplayer-setup`).style.display = 'none';
            document.getElementById(`${game}-game-area`).style.display = 'block';

            listenRoom();
            initGameLogic(game);
            
            alert("ROOM CODE: " + roomId + "\n\nShare this code with friends!");
        }

        async function joinGame(game) {
            if (!window.currentUID || !window.playerData) {
                return alert("Please log in first!");
            }
            
            const code = prompt("Enter Room Code");
            if (!code) return;

            roomId = code;
            gameMode = "multi";
            isHost = false;
            currentGame = game;

            const { doc, getDoc, updateDoc } = window.firestore;
            const roomRef = doc(window.db, "rooms", roomId);
            const snap = await getDoc(roomRef);

            if (!snap.exists()) return alert("Room not found");

            const data = snap.data();
            
            if (data.game !== game) {
                return alert(`This room is for ${data.game.toUpperCase()}, not ${game.toUpperCase()}`);
            }

            await updateDoc(roomRef, { [`players.${window.currentUID}`]: window.playerData });

            document.getElementById(`${game}-multiplayer-setup`).style.display = 'none';
            document.getElementById(`${game}-game-area`).style.display = 'block';

            listenRoom();
            initGameLogic(game);
        }

        function listenRoom() {
            if (roomUnsubscribe) roomUnsubscribe();
            
            const { doc, onSnapshot } = window.firestore;
            roomUnsubscribe = onSnapshot(doc(window.db, "rooms", roomId), snap => {
                if (!snap.exists()) return;
                const data = snap.data();

                if (currentGame === 'poker') {
                    replaceAIWithMultiplayerPlayers(data);
                }

                if (isHost) {
                    syncRoom();
                } else if (data.gameState) {
                    applyGameState(data.gameState);
                }
                
                renderCurrentGame();
            });
        }

        function syncRoom() {
            if (gameMode !== "multi" || !isHost || !roomId) return;
            
            const { doc, updateDoc } = window.firestore;
            const gameState = getCurrentGameState();
            
            updateDoc(doc(window.db, "rooms", roomId), {
                gameState: gameState
            }).catch(err => console.error("Sync error:", err));
        }

        function getCurrentGameState() {
            if (currentGame === 'blackjack' && window.bj) {
                return { state, bj: window.bj };
            } else if (currentGame === 'roulette' && window.roulette) {
                return { state, roulette: window.roulette };
            } else if (currentGame === 'poker' && window.poker) {
                return { state, poker: window.poker };
            } else if (currentGame === 'craps' && window.craps) {
                return { state, craps: window.craps };
            } else if (currentGame === 'slots' && window.slots) {
                return { state, slots: window.slots };
            }
            return { state };
        }

        function applyGameState(gameState) {
            state = gameState.state;
            updateHUD();

            if (currentGame === 'blackjack' && gameState.bj) {
                window.bj = gameState.bj;
            } else if (currentGame === 'roulette' && gameState.roulette) {
                window.roulette = gameState.roulette;
            } else if (currentGame === 'poker' && gameState.poker) {
                window.poker = gameState.poker;
            } else if (currentGame === 'craps' && gameState.craps) {
                window.craps = gameState.craps;
            } else if (currentGame === 'slots' && gameState.slots) {
                window.slots = gameState.slots;
            }
        }

        function renderCurrentGame() {
            if (currentGame === 'blackjack') renderBlackjack();
            else if (currentGame === 'roulette') renderRoulette();
            else if (currentGame === 'poker') renderPoker();
            else if (currentGame === 'craps') renderCraps();
            else if (currentGame === 'slots') renderSlots();
        }

        function initGameLogic(game) {
            if (game === 'blackjack') startSoloBlackjack();
            else if (game === 'roulette') startSoloRoulette();
            else if (game === 'poker') startSoloPoker();
            else if (game === 'craps') startSoloCraps();
            else if (game === 'slots') startSoloSlots();
        }

        /* ======================
           SOLO GAME STARTERS
        ====================== */
        function startSoloBlackjack() {
            gameMode = "single";
            currentGame = "blackjack";
            document.getElementById('bj-multiplayer-setup').style.display = 'none';
            document.getElementById('bj-game-area').style.display = 'block';
        }

        function startSoloRoulette() {
            gameMode = "single";
            currentGame = "roulette";
            document.getElementById('roulette-multiplayer-setup').style.display = 'none';
            document.getElementById('roulette-game-area').style.display = 'block';
            initRoulette();
        }

        function startSoloPoker() {
            gameMode = "single";
            currentGame = "poker";
            document.getElementById('poker-setup').style.display = 'none';
            initPoker(true); // true = use AI
        }

        function startSoloCraps() {
            gameMode = "single";
            currentGame = "craps";
            document.getElementById('craps-multiplayer-setup').style.display = 'none';
            document.getElementById('craps-game-area').style.display = 'block';
        }

        function startSoloSlots() {
            gameMode = "single";
            currentGame = "slots";
            document.getElementById('slots-multiplayer-setup').style.display = 'none';
            document.getElementById('slots-game-area').style.display = 'block';
            initSlots();
        }

        /* ======================
           CARD UTILITIES
        ====================== */
        function createDeck() {
            const suits = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
            const values = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
            let deck = [];
            for (let s of suits) for (let v of values) deck.push(v + s);
            return deck.sort(() => Math.random() - 0.5);
        }

        function cardValue(card) {
            const val = card.slice(0, -1);
            if (val === 'A') return 11;
            if (['J','Q','K'].includes(val)) return 10;
            return parseInt(val);
        }

        function handTotal(hand) {
            let total = hand.reduce((sum, c) => sum + cardValue(c), 0);
            let aces = hand.filter(c => c[0] === 'A').length;
            while (total > 21 && aces > 0) { total -= 10; aces--; }
            return total;
        }

        function renderCard(card, hidden = false) {
            const div = document.createElement('div');
            div.className = 'card';
            if (hidden) {
                div.classList.add('hidden-card');
            } else {
                if (card.includes('‚ô•') || card.includes('‚ô¶')) div.classList.add('red');
                div.innerHTML = `<div>${card.slice(0, -1)}</div><div style="font-size: 20px;">${card.slice(-1)}</div><div style="transform: rotate(180deg);">${card.slice(0, -1)}</div>`;
            }
            return div;
        }

        /* ======================
           BLACKJACK
        ====================== */
        function dealBlackjack() {
            const bet = parseInt(document.getElementById('bj-bet-input').value) || 50;
            if (!deductBet(bet)) { checkBankruptcy(); return; }
            
            window.bj = { 
                deck: createDeck(), 
                dealerHand: [], 
                playerHand: [], 
                bet, 
                active: true 
            };
            
            window.bj.dealerHand.push(window.bj.deck.pop(), window.bj.deck.pop());
            window.bj.playerHand.push(window.bj.deck.pop(), window.bj.deck.pop());
            
            renderBlackjack();
            
            document.getElementById('btn-hit').disabled = false;
            document.getElementById('btn-stand').disabled = false;
            document.getElementById('btn-double').disabled = false;
            document.getElementById('bj-result').innerText = '';

            if (gameMode === "multi") syncRoom();
        }

        function renderBlackjack() {
            if (!window.bj) return;
            
            const dealerDiv = document.getElementById('dealer-hand');
            const playerDiv = document.getElementById('player-hand');
            
            dealerDiv.innerHTML = '';
            playerDiv.innerHTML = '';
            
            window.bj.dealerHand.forEach((c, i) => dealerDiv.appendChild(renderCard(c, i === 1 && window.bj.active)));
            window.bj.playerHand.forEach(c => playerDiv.appendChild(renderCard(c)));
            
            document.getElementById('dealer-score').innerText = window.bj.active ? 'SCORE: ?' : `SCORE: ${handTotal(window.bj.dealerHand)}`;
            document.getElementById('player-score').innerText = `SCORE: ${handTotal(window.bj.playerHand)}`;
        }

        function bjAction(action) {
            if (!window.bj || !window.bj.active) return;
            
            if (gameMode === "multi" && !isHost) return; // Only host can control in multiplayer
            
            if (action === 'hit') {
                window.bj.playerHand.push(window.bj.deck.pop());
                renderBlackjack();
                if (handTotal(window.bj.playerHand) > 21) endBlackjack();
            } else if (action === 'stand') {
                endBlackjack();
            } else if (action === 'double') {
                if (!deductBet(window.bj.bet)) return;
                window.bj.bet *= 2;
                window.bj.playerHand.push(window.bj.deck.pop());
                renderBlackjack();
                endBlackjack();
            }

            if (gameMode === "multi") syncRoom();
        }

        function endBlackjack() {
            window.bj.active = false;
            while (handTotal(window.bj.dealerHand) < 17) window.bj.dealerHand.push(window.bj.deck.pop());
            renderBlackjack();
            
            const pTotal = handTotal(window.bj.playerHand);
            const dTotal = handTotal(window.bj.dealerHand);
            let result = '';
            
            if (pTotal > 21) result = 'BUST! DEALER WINS';
            else if (dTotal > 21) { result = 'DEALER BUST! YOU WIN'; updateBalance(window.bj.bet * 2); }
            else if (pTotal > dTotal) { result = 'YOU WIN!'; updateBalance(window.bj.bet * 2); }
            else if (pTotal < dTotal) result = 'DEALER WINS';
            else { result = 'PUSH (TIE)'; updateBalance(window.bj.bet); }
            
            document.getElementById('bj-result').innerText = result;
            document.getElementById('btn-hit').disabled = true;
            document.getElementById('btn-stand').disabled = true;
            document.getElementById('btn-double').disabled = true;
            
            checkBankruptcy();
            if (gameMode === "multi") syncRoom();
        }

        /* ======================
           ROULETTE
        ====================== */
        const rouletteLayout = [
            {num: 0, color: 'green'},
            {num: 1, color: 'red'}, {num: 2, color: 'black'}, {num: 3, color: 'red'},
            {num: 4, color: 'black'}, {num: 5, color: 'red'}, {num: 6, color: 'black'},
            {num: 7, color: 'red'}, {num: 8, color: 'black'}, {num: 9, color: 'red'},
            {num: 10, color: 'black'}, {num: 11, color: 'black'}, {num: 12, color: 'red'},
            {num: 13, color: 'black'}, {num: 14, color: 'red'}, {num: 15, color: 'black'},
            {num: 16, color: 'red'}, {num: 17, color: 'black'}, {num: 18, color: 'red'},
            {num: 19, color: 'red'}, {num: 20, color: 'black'}, {num: 21, color: 'red'},
            {num: 22, color: 'black'}, {num: 23, color: 'red'}, {num: 24, color: 'black'},
            {num: 25, color: 'red'}, {num: 26, color: 'black'}, {num: 27, color: 'red'},
            {num: 28, color: 'black'}, {num: 29, color: 'black'}, {num: 30, color: 'red'},
            {num: 31, color: 'black'}, {num: 32, color: 'red'}, {num: 33, color: 'black'},
            {num: 34, color: 'red'}, {num: 35, color: 'black'}, {num: 36, color: 'red'}
        ];

        function initRoulette() {
            window.roulette = { bets: {}, totalBet: 0 };
            const grid = document.querySelector('.roulette-grid');
            grid.innerHTML = '';
            
            rouletteLayout.forEach(item => {
                const cell = document.createElement('div');
                cell.className = `r-cell r-${item.color}`;
                cell.innerText = item.num;
                cell.onclick = () => placeRouletteBet('number', item.num);
                grid.appendChild(cell);
            });
            
            const outsideBets = [
                {label: 'RED', type: 'red'}, {label: 'BLACK', type: 'black'},
                {label: '1-18', type: 'low'}, {label: '19-36', type: 'high'},
                {label: 'EVEN', type: 'even'}, {label: 'ODD', type: 'odd'},
                {label: '1st 12', type: 'dozen1'}, {label: '2nd 12', type: 'dozen2'}, {label: '3rd 12', type: 'dozen3'}
            ];
            
            outsideBets.forEach(b => {
                const cell = document.createElement('div');
                cell.className = 'r-cell r-black';
                cell.style.fontSize = '8px';
                cell.style.gridColumn = 'span 2';
                cell.innerText = b.label;
                cell.onclick = () => placeRouletteBet(b.type);
                grid.appendChild(cell);
            });
        }

        function placeRouletteBet(type, num = null) {
            const betAmt = parseInt(document.getElementById('roulette-bet-amount').value) || 50;
            const key = type === 'number' ? `num-${num}` : type;
            
            window.roulette.bets[key] = (window.roulette.bets[key] || 0) + betAmt;
            window.roulette.totalBet += betAmt;
            
            document.getElementById('roulette-total-bet').innerText = '$' + window.roulette.totalBet;
            document.getElementById('btn-spin-roulette').disabled = false;

            if (gameMode === "multi") syncRoom();
        }

        function clearRouletteBets() {
            window.roulette.bets = {};
            window.roulette.totalBet = 0;
            document.getElementById('roulette-total-bet').innerText = '$0';
            document.getElementById('btn-spin-roulette').disabled = true;

            if (gameMode === "multi") syncRoom();
        }

        function spinRoulette() {
            if (gameMode === "multi" && !isHost) return;
            
            if (!deductBet(window.roulette.totalBet)) { checkBankruptcy(); return; }
            
            const result = rouletteLayout[Math.floor(Math.random() * rouletteLayout.length)];
            showRouletteWheel(result);
            
            setTimeout(() => {
                let winnings = 0;
                Object.keys(window.roulette.bets).forEach(key => {
                    const bet = window.roulette.bets[key];
                    if (key === `num-${result.num}`) winnings += bet * 36;
                    else if (key === result.color && result.num !== 0) winnings += bet * 2;
                    else if (key === 'low' && result.num >= 1 && result.num <= 18) winnings += bet * 2;
                    else if (key === 'high' && result.num >= 19 && result.num <= 36) winnings += bet * 2;
                    else if (key === 'even' && result.num % 2 === 0 && result.num !== 0) winnings += bet * 2;
                    else if (key === 'odd' && result.num % 2 === 1) winnings += bet * 2;
                    else if (key === 'dozen1' && result.num >= 1 && result.num <= 12) winnings += bet * 3;
                    else if (key === 'dozen2' && result.num >= 13 && result.num <= 24) winnings += bet * 3;
                    else if (key === 'dozen3' && result.num >= 25 && result.num <= 36) winnings += bet * 3;
                });
                
                if (winnings > 0) {
                    updateBalance(winnings);
                    alert(`YOU WON $${winnings}!`);
                }
                
                clearRouletteBets();
                checkBankruptcy();
                if (gameMode === "multi") syncRoom();
            }, 5000);
        }

        function showRouletteWheel(result) {
            const modal = document.getElementById('roulette-spin-modal');
            const wheel = document.getElementById('roulette-wheel');
            const resultText = document.getElementById('roulette-result-text');
            
            wheel.innerHTML = '<div class="wheel-center"></div>';
            
            rouletteLayout.forEach((item, i) => {
                const angle = (360 / rouletteLayout.length) * i;
                const numDiv = document.createElement('div');
                numDiv.className = 'wheel-number-item';
                numDiv.style.transform = `rotate(${angle}deg)`;
                numDiv.innerHTML = `<div style="background: ${item.color === 'green' ? '#0a0' : item.color === 'red' ? '#d00' : '#111'}; color: white; padding: 2px 6px; border-radius: 4px;">${item.num}</div>`;
                wheel.appendChild(numDiv);
            });
            
            modal.style.display = 'flex';
            
            const spinAmount = 1440 + (360 / rouletteLayout.length) * rouletteLayout.findIndex(x => x.num === result.num);
            wheel.style.transform = `rotate(${spinAmount}deg)`;
            resultText.innerText = `SPINNING...`;
            
            setTimeout(() => {
                resultText.innerText = `RESULT: ${result.num} (${result.color.toUpperCase()})`;
                setTimeout(() => {
                    modal.style.display = 'none';
                    wheel.style.transform = 'rotate(0deg)';
                }, 2000);
            }, 4000);
        }

        function renderRoulette() {
            if (!window.roulette) return;
            document.getElementById('roulette-total-bet').innerText = '$' + window.roulette.totalBet;
        }

        /* ======================
           POKER
        ====================== */
        function initPoker(useAI = true) {
            window.poker = {
                deck: createDeck(),
                players: [],
                community: [],
                pot: 0,
                currentBet: 50,
                turn: 0,
                phase: 'preflop',
                active: false
            };

            if (useAI) {
                window.poker.players = [
                    { id: 'player', name: 'You', balance: state.balance, seat: 0, cards: [], status: 'active', isAI: false },
                    { id: 'ai1', name: 'AI-1', balance: 1000, seat: 1, cards: [], status: 'active', isAI: true },
                    { id: 'ai2', name: 'AI-2', balance: 1000, seat: 2, cards: [], status: 'active', isAI: true },
                    { id: 'ai3', name: 'AI-3', balance: 1000, seat: 3, cards: [], status: 'active', isAI: true }
                ];

                // Show all AI slots
                for (let i = 0; i < 4; i++) {
                    document.getElementById(`p-slot-${i}`).style.display = 'block';
                }
            } else {
                window.poker.players = [
                    { id: window.currentUID, name: window.playerData.name, balance: state.balance, seat: 0, cards: [], status: 'active', isAI: false }
                ];

                // Hide AI slots initially in multiplayer
                for (let i = 1; i < 4; i++) {
                    document.getElementById(`p-slot-${i}`).style.display = 'none';
                }
            }

            dealPokerHands();
            renderPoker();
        }

        function dealPokerHands() {
            window.poker.players.forEach(p => {
                p.cards = [window.poker.deck.pop(), window.poker.deck.pop()];
                p.balance -= 50;
                window.poker.pot += 50;
            });
            window.poker.active = true;
            window.poker.turn = 0;
        }

        function replaceAIWithMultiplayerPlayers(roomData) {
            if (!window.poker) return;

            const realPlayers = Object.entries(roomData.players).map(([uid, p], index) => ({
                id: uid,
                name: p.name,
                balance: p.balance,
                seat: index,
                isAI: false,
                cards: window.poker.players[index]?.cards || [],
                status: window.poker.players[index]?.status || 'active'
            }));

            window.poker.players = realPlayers;

            // Show only the slots we need, hide the rest
            for (let i = 0; i < 4; i++) {
                const slot = document.getElementById(`p-slot-${i}`);
                const nameLabel = document.getElementById(`p-name-${i}`);
                
                if (i < realPlayers.length) {
                    if (slot) slot.style.display = 'block';
                    if (nameLabel) nameLabel.innerText = realPlayers[i].name;
                } else {
                    if (slot) slot.style.display = 'none';
                }
            }
        }

        function renderPoker() {
            if (!window.poker) return;
            
            document.getElementById('poker-pot').innerText = window.poker.pot;
            
            const communityDiv = document.getElementById('community-cards');
            communityDiv.innerHTML = '';
            window.poker.community.forEach(c => communityDiv.appendChild(renderCard(c)));
            
            window.poker.players.forEach((p, i) => {
                const cardDiv = document.querySelector(`[data-player="${i}"]`);
                const balanceSpan = document.querySelector(`[data-balance="${i}"]`);
                const betSpan = document.querySelector(`[data-bet="${i}"]`);
                
                if (cardDiv) {
                    cardDiv.innerHTML = '';
                    if (i === 0 || (gameMode === "multi" && p.id === window.currentUID)) {
                        p.cards.forEach(c => cardDiv.appendChild(renderCard(c)));
                    } else {
                        p.cards.forEach(() => cardDiv.appendChild(renderCard('', true)));
                    }
                }
                
                if (balanceSpan) balanceSpan.innerText = p.balance;
                if (betSpan) betSpan.innerText = window.poker.currentBet || 0;
                
                const slot = document.getElementById(`p-slot-${i}`);
                if (slot) {
                    slot.classList.toggle('active-turn', window.poker.turn === i && window.poker.active);
                }
            });
            
            const myIndex = window.poker.players.findIndex(p => p.id === window.currentUID || p.id === 'player');
            const canAct = window.poker.active && window.poker.turn === myIndex;
            
            document.getElementById('btn-fold').disabled = !canAct;
            document.getElementById('btn-call').disabled = !canAct;
            document.getElementById('btn-raise').disabled = !canAct;
        }

        function pokerAction(type) {
            if (!window.poker || !window.poker.active) return;
            
            const myIndex = window.poker.players.findIndex(p => p.id === window.currentUID || p.id === 'player');
            
            if (gameMode === "multi") {
                if (window.poker.turn !== myIndex) return;
            }
            
            const player = window.poker.players[window.poker.turn];
            
            if (type === 'fold') {
                player.status = 'folded';
            } else if (type === 'call') {
                const callAmt = Math.min(window.poker.currentBet, player.balance);
                player.balance -= callAmt;
                window.poker.pot += callAmt;
            } else if (type === 'raise') {
                const raiseAmt = Math.min(window.poker.currentBet + 50, player.balance);
                player.balance -= raiseAmt;
                window.poker.pot += raiseAmt;
                window.poker.currentBet += 50;
            }
            
            if (window.poker.turn === myIndex) state.balance = player.balance;
            
            // Advance turn
            window.poker.turn = (window.poker.turn + 1) % window.poker.players.length;
            while (window.poker.players[window.poker.turn].status === 'folded') {
                window.poker.turn = (window.poker.turn + 1) % window.poker.players.length;
            }
            
            if (window.poker.turn === 0 && window.poker.active) advancePokerPhase();
            
            renderPoker();
            
            if (gameMode === "multi") {
                syncRoom();
            } else if (window.poker.active && window.poker.players[window.poker.turn].isAI) {
                setTimeout(() => {
                    const aiAction = Math.random() < 0.3 ? 'fold' : Math.random() < 0.5 ? 'call' : 'raise';
                    pokerAction(aiAction);
                }, 1000);
            }
        }

        function advancePokerPhase() {
            if (window.poker.phase === 'preflop') {
                window.poker.community = [window.poker.deck.pop(), window.poker.deck.pop(), window.poker.deck.pop()];
                window.poker.phase = 'flop';
            } else if (window.poker.phase === 'flop') {
                window.poker.community.push(window.poker.deck.pop());
                window.poker.phase = 'turn';
            } else if (window.poker.phase === 'turn') {
                window.poker.community.push(window.poker.deck.pop());
                window.poker.phase = 'river';
            } else {
                endPoker();
            }
        }

        function endPoker() {
            window.poker.active = false;
            const activePlayers = window.poker.players.filter(p => p.status !== 'folded');
            
            if (activePlayers.length === 1) {
                activePlayers[0].balance += window.poker.pot;
                if (activePlayers[0].id === 'player' || activePlayers[0].id === window.currentUID) {
                    state.balance += window.poker.pot;
                }
            } else {
                const winner = activePlayers[Math.floor(Math.random() * activePlayers.length)];
                winner.balance += window.poker.pot;
                if (winner.id === 'player' || winner.id === window.currentUID) {
                    state.balance += window.poker.pot;
                }
            }
            
            document.getElementById('poker-result').innerText = 'Round over! Start a new game to continue.';
            updateHUD();
            saveGame();
            checkBankruptcy();
            
            document.getElementById('poker-setup').style.display = 'flex';
        }

        /* ======================
           CRAPS
        ====================== */
        function initCraps() {
            window.craps = { bets: { pass: 0, field: 0 }, point: 0 };
        }

        function placeCrapsBet(type) {
            const amt = parseInt(document.getElementById(`craps-bet-${type}`).value) || 50;
            if (!deductBet(amt)) { checkBankruptcy(); return; }
            
            window.craps.bets[type] = (window.craps.bets[type] || 0) + amt;
            document.getElementById(`bet-${type}`).innerText = '$' + window.craps.bets[type];

            if (gameMode === "multi") syncRoom();
        }

        function rollDice() {
            if (gameMode === "multi" && !isHost) return;
            
            const d1 = Math.ceil(Math.random() * 6);
            const d2 = Math.ceil(Math.random() * 6);
            const total = d1 + d2;
            
            const dice = document.getElementById('craps-dice').children;
            dice[0].innerText = d1;
            dice[1].innerText = d2;
            
            let winAmt = 0;
            
            if (window.craps.point === 0) {
                if (total === 7 || total === 11) winAmt += (window.craps.bets.pass || 0) * 2;
                else if (total === 2 || total === 3 || total === 12) window.craps.bets.pass = 0;
                else window.craps.point = total;
            } else {
                if (total === window.craps.point) {
                    winAmt += (window.craps.bets.pass || 0) * 2;
                    window.craps.point = 0;
                } else if (total === 7) {
                    window.craps.point = 0;
                    window.craps.bets.pass = 0;
                }
            }
            
            if ([2,3,4,9,10,11,12].includes(total)) winAmt += (window.craps.bets.field || 0) * 2;
            
            window.craps.bets.field = 0;
            document.getElementById('bet-field').innerText = '$0';
            document.getElementById('bet-pass').innerText = `$${window.craps.bets.pass || 0}`;
            document.getElementById('craps-point-display').innerText = `POINT: ${window.craps.point || 'OFF'}`;
            
            if (winAmt > 0) updateBalance(winAmt);
            
            checkBankruptcy();
            if (gameMode === "multi") syncRoom();
        }

        function renderCraps() {
            if (!window.craps) return;
            document.getElementById('bet-pass').innerText = '$' + (window.craps.bets.pass || 0);
            document.getElementById('bet-field').innerText = '$' + (window.craps.bets.field || 0);
            document.getElementById('craps-point-display').innerText = `POINT: ${window.craps.point || 'OFF'}`;
        }

        /* ======================
           SLOTS
        ====================== */
        const slotSymbols = ['üçí', 'üçã', '‚≠ê', 'üíé', '7Ô∏è‚É£'];
        const slotPayouts = { 'üçí': 2, 'üçã': 3, '‚≠ê': 5, 'üíé': 10, '7Ô∏è‚É£': 25 };

        function initSlots() {
            window.slots = { reels: [0, 0, 0] };
            
            for (let i = 1; i <= 3; i++) {
                const reel = document.getElementById(`reel-${i}`);
                reel.innerHTML = '';
                
                // Create extended reel (symbols repeated for smooth scrolling)
                const extendedSymbols = [...slotSymbols, ...slotSymbols, ...slotSymbols, ...slotSymbols];
                extendedSymbols.forEach(symbol => {
                    const div = document.createElement('div');
                    div.className = 'slot-symbol';
                    div.innerText = symbol;
                    reel.appendChild(div);
                });
                
                reel.style.top = '0px';
            }
        }

        function spinSlots() {
            if (gameMode === "multi" && !isHost) return;
            
            const bet = parseInt(document.getElementById('slots-bet-input').value) || 50;
            if (!deductBet(bet)) { checkBankruptcy(); return; }
            
            const results = [
                Math.floor(Math.random() * slotSymbols.length),
                Math.floor(Math.random() * slotSymbols.length),
                Math.floor(Math.random() * slotSymbols.length)
            ];
            
            window.slots.reels = results;
            
            // Animate each reel
            for (let i = 1; i <= 3; i++) {
                const reel = document.getElementById(`reel-${i}`);
                const finalPos = -(results[i-1] * 100 + 1000); // Offset for visual effect
                
                reel.style.transition = 'none';
                reel.style.top = '0px';
                
                setTimeout(() => {
                    reel.style.transition = `top ${0.5 + i * 0.2}s cubic-bezier(0.25, 0.46, 0.45, 0.94)`;
                    reel.style.top = finalPos + 'px';
                }, 50);
            }
            
            setTimeout(() => {
                checkSlotsWin(bet, results);
                if (gameMode === "multi") syncRoom();
            }, 1500);
        }

        function checkSlotsWin(bet, results) {
            const symbols = results.map(i => slotSymbols[i]);
            
            if (symbols[0] === symbols[1] && symbols[1] === symbols[2]) {
                const payout = bet * slotPayouts[symbols[0]];
                updateBalance(payout);
                document.getElementById('slots-result').innerText = `üéâ JACKPOT! YOU WON $${payout}!`;
            } else {
                document.getElementById('slots-result').innerText = 'Try again!';
            }
            
            checkBankruptcy();
        }

        function renderSlots() {
            if (!window.slots) return;
            // Rendering handled by animation
        }

        /* ======================
           INFO MODALS
        ====================== */
        const gameRules = {
            blackjack: `<ul class="rule-list">
                <li><b>Goal:</b> Get a hand total closer to 21 than the dealer without going over.</li>
                <li><b>Card Values:</b> Face cards = 10, Aces = 1 or 11.</li>
                <li><b>Actions:</b> HIT (draw card), STAND (end turn), DOUBLE DOWN (double bet, get 1 card).</li>
                <li><b>Dealer:</b> Must hit on 16 or less, stand on 17+.</li>
                <li><b>Payout:</b> Win pays 2:1, Blackjack pays 3:2.</li>
            </ul>`,
            roulette: `<ul class="rule-list">
                <li><b>Goal:</b> Predict where the ball will land on the spinning wheel.</li>
                <li><b>Bets:</b> Click any number, color, or range on the grid to place bets.</li>
                <li><b>Payouts:</b> Single number = 35:1, Red/Black = 2:1, Dozen/Column = 3:1.</li>
                <li><b>Green (0):</b> House wins on 0 unless you bet on it directly.</li>
            </ul>`,
            poker: `<ul class="rule-list">
                <li><b>Goal:</b> Make the best 5-card hand using your 2 cards + 5 community cards.</li>
                <li><b>Rounds:</b> Pre-Flop, Flop (3 cards), Turn (1 card), River (1 card).</li>
                <li><b>Actions:</b> FOLD (quit), CALL (match bet), RAISE (increase bet).</li>
                <li><b>Multiplayer:</b> Host or join a table to play with friends! AI disappears in multiplayer mode.</li>
                <li><b>Hand Rankings:</b> Royal Flush > Straight Flush > Four of a Kind > Full House > Flush > Straight > Three of a Kind > Two Pair > Pair > High Card.</li>
            </ul>`,
            craps: `<ul class="rule-list">
                <li><b>Goal:</b> Bet on the outcome of two dice rolls.</li>
                <li><b>Pass Line:</b> Win on 7 or 11 (come out), lose on 2, 3, 12. Otherwise, set a "point" and try to roll it again before a 7.</li>
                <li><b>Field:</b> Win on 2, 3, 4, 9, 10, 11, 12 on any roll.</li>
                <li><b>Payouts:</b> Pass Line = 2:1, Field = 2:1.</li>
            </ul>`,
            slots: `<ul class="rule-list">
                <li><b>Goal:</b> Spin the reels and match 3 symbols to win.</li>
                <li><b>Symbols:</b> üçí Cherry (2x), üçã Lemon (3x), ‚≠ê Star (5x), üíé Diamond (10x), 7Ô∏è‚É£ Lucky 7 (25x).</li>
                <li><b>Jackpot:</b> Three 7Ô∏è‚É£ symbols wins 25x your bet!</li>
            </ul>`
        };

        function showInfoModal(game) {
            document.getElementById('info-modal-content').innerHTML = gameRules[game];
            document.getElementById('info-modal').style.display = 'flex';
        }

        function closeInfoModal() {
            document.getElementById('info-modal').style.display = 'none';
        }

        /* ======================
           INITIALIZATION
        ====================== */
        window.onload = function() {
            loadGame();
            initCraps();
        };
    </script>

</body>
</html>
